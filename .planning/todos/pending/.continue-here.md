---
task: consolidate-system-config-ssot
branch: fix/phase-3.1-cleanup
status: ready-to-start
last_updated: 2026-02-04T00:30:00Z
---

# Handoff: Consolidate System Config SSOT

## Task

Merge `config/deploy/` and `config/etc-mirrors/` into a single source of truth directory.

## Current State

Two directories with overlapping purpose:

| Directory | Purpose | Consumed by deploy.sh? |
|-----------|---------|------------------------|
| `config/deploy/` | Files to copy TO /etc/ | Yes |
| `config/etc-mirrors/` | Reference copies FROM /etc/ | No (just visibility) |

## Files to Migrate

**From `config/etc-mirrors/` → `config/deploy/`:**

```
profile.d/ds01-docker-group.sh  → config/deploy/profile.d/
profile.d/ds01-path.sh          → config/deploy/profile.d/
sudoers.d/ds01-docker-group     → config/deploy/sudoers.d/
sudoers.d/ds01-user-slice       → config/deploy/sudoers.d/
bash.bashrc                     → config/deploy/bash.bashrc
systemd/system/ds01.slice.conf  → config/deploy/systemd/
logrotate.d/ds01-infra-logrotate.conf → config/deploy/logrotate.d/
cron.d/ds01-container-cleanup   → config/deploy/cron.d/
cron.d/ds01-gpu-cleanup         → config/deploy/cron.d/
```

## Steps

1. **Inventory current state:**
   ```bash
   ls -la config/deploy/
   ls -la config/etc-mirrors/
   ```

2. **Move files from etc-mirrors → deploy:**
   ```bash
   # profile.d
   mv config/etc-mirrors/profile.d/* config/deploy/profile.d/

   # sudoers.d (new subdir)
   mkdir -p config/deploy/sudoers.d
   mv config/etc-mirrors/sudoers.d/* config/deploy/sudoers.d/

   # cron.d
   mv config/etc-mirrors/cron.d/* config/deploy/cron.d/

   # logrotate.d
   mv config/etc-mirrors/logrotate.d/* config/deploy/logrotate.d/

   # systemd
   mv config/etc-mirrors/systemd/system/* config/deploy/systemd/

   # bash.bashrc (special - goes to /etc/)
   mv config/etc-mirrors/bash.bashrc config/deploy/
   ```

3. **Remove etc-mirrors:**
   ```bash
   rm -rf config/etc-mirrors/
   ```

4. **Update deploy.sh** to deploy new paths:
   - Add sudoers.d deployment
   - Add bash.bashrc deployment
   - Ensure all profile.d files deployed

5. **Update CLAUDE.md references** in config/

6. **Test:**
   ```bash
   sudo deploy
   # Verify files appear in /etc/
   ```

## Git State

- Branch: `fix/phase-3.1-cleanup`
- Commits ahead of main: 4
- Ready to push when network back

## After Completion

1. Commit changes
2. Mark todo as done: `mv .planning/todos/pending/2026-01-31-consolidate-system-config-ssot.md .planning/todos/done/`
3. Push branch
4. Squash-merge to main

## Related Files

- `scripts/system/deploy.sh` — needs updates for new paths
- `config/CLAUDE.md` — update directory references
- Todo: `.planning/todos/pending/2026-01-31-consolidate-system-config-ssot.md`
