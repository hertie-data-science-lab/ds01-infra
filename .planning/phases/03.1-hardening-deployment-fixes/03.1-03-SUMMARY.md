---
phase: 03.1-hardening-deployment-fixes
plan: 03
subsystem: infra
tags: [gpu-access-control, video-group, udev, docker-wrapper, bare-metal-access]

# Dependency graph
requires:
  - phase: 02.1-gpu-access-control-research
    provides: Three-layer GPU access control architecture design
  - phase: 03-access-control
    provides: Bare metal access grant system framework
provides:
  - Video group restricted to exempt users only (Layer 3 access control)
  - GPU awareness script with three-tier exemption logic
  - Udev rules removed (device permissions at defaults)
  - nvidia-* wrappers deployed as UX tools
  - Docker wrapper in enforcing mode by default
affects: [deployment, bare-metal-access, user-onboarding]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Three-tier exemption check pattern in profile.d scripts
    - Restrictive group sync (add + remove non-members)

key-files:
  created: []
  modified:
    - config/deploy/profile.d/ds01-gpu-awareness.sh
    - scripts/system/deploy.sh

key-decisions:
  - "Video group restricted to exempt users only (removes non-exempt users on deploy)"
  - "Device permissions remain at defaults (0666) — no udev manipulation"
  - "nvidia-* wrappers deployed as UX tools (not security boundary)"
  - "Three exemption checks: grant file → config exempt_users → video group membership"

patterns-established:
  - "Restrictive group sync pattern: build exempt list, add missing, remove non-members"
  - "Three-layer GPU access control: L1=CUDA_VISIBLE_DEVICES (host deterrent), L2=Docker device mapping (container security), L3=video group exemption (opt-in bare-metal)"

# Metrics
duration: 2min
completed: 2026-02-01
---

# Phase 3.1 Plan 03: Bare Metal Access Control Deployment Summary

**Three-layer GPU access control fully deployed: CUDA_VISIBLE_DEVICES deterrent (L1), Docker device mapping security (L2), and video group exemption (L3) with restrictive group sync removing non-exempt users**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-01T14:24:11Z
- **Completed:** 2026-02-01T14:26:14Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- Video group restricted to exempt users only (non-exempt users removed on deploy)
- GPU awareness script has three-tier exemption logic (grant file → config → video group)
- Udev rules removed (device permissions at driver defaults 0666)
- nvidia-* wrappers deployed as UX tools (helpful error messages)
- Docker wrapper confirmed in enforcing mode by default
- Design-implementation drift from 02.1-DESIGN.md fully resolved

## Task Commits

Each task was committed atomically:

1. **Task 1: Add video group exemption check to GPU awareness** - `0b62c96` (feat)
2. **Task 2: Complete bare metal access control deployment** - `efac393` (feat)

## Files Created/Modified

- `config/deploy/profile.d/ds01-gpu-awareness.sh` - Added video group membership check as third exemption layer (after grant file and config checks)
- `scripts/system/deploy.sh` - Added udev cleanup, restrictive video group sync (removes non-exempt), nvidia wrapper deployment, enforcing mode confirmation

## Decisions Made

**Video group restriction approach:**
- Build exempt list from config `bare_metal_access.exempt_users`
- Add users with active grant files to exempt list
- Add exempt users to video group if missing
- **Remove non-exempt users from video group** (key difference from previous additive-only sync)

**Device permissions policy:**
- Removed udev rules (99-ds01-nvidia.rules)
- Device permissions remain at driver defaults (0666)
- No permission manipulation (aligned with HPC research from 02.1-02)

**nvidia-* wrappers:**
- Deployed as UX tools (not security boundary)
- Provide helpful error messages for blocked users
- Deployed for: nvidia-smi, nvidia-settings, nvidia-debugdump, nvidia-cuda-mps-control, nvidia-cuda-mps-server, nvidia-xconfig

**Docker wrapper isolation:**
- Defaults to enforcing mode (DS01_ISOLATION_MODE=full)
- Can be overridden via environment variable for safe rollout
- No code change needed — already enforcing by default

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## Next Phase Readiness

**Ready for Phase 3.1 completion:**
- All access control components deployed and aligned with design
- Video group restriction operational
- Udev rules removed
- Three-layer architecture fully implemented

**Remaining Phase 3.1 work:**
- Plan 03.1-04: Final integration testing and validation

**No blockers or concerns.**

---
*Phase: 03.1-hardening-deployment-fixes*
*Completed: 2026-02-01*
